<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Trading - Manajemen Transaksi</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SheetJS untuk Export Excel Rapih -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.294.0"
      }
    }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Courier+Prime&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .font-print { font-family: 'Courier Prime', monospace; }

        @media print {
            body { background: white !important; }
            .no-print { display: none !important; }
            .print-area { display: block !important; padding: 0; margin: 0; width: 100%; }
            @page { size: auto; margin: 0mm; }
            
            .spj-blanko-data {
                position: relative;
                width: 210mm; 
                height: 140mm; 
                /* Padding handled by absolute positioning configurations */
            }
        }

        .preview-modal {
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Truck, ClipboardList, CheckCircle, PlusCircle, User, Phone, 
            Box, Search, History, Settings, Save, AlertCircle, Users, 
            Package, Printer, Calendar, FileText, X, Eye, AlignJustify, 
            TrendingUp, MessageSquare, Pencil, Trash2, FileSpreadsheet, Download, Send, Lock
        } from 'lucide-react';
        
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, doc, updateDoc, deleteDoc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhL4pBXzoaSkNjHWe524KQLAhd335qITs",
            authDomain: "logistik-tracker-app.firebaseapp.com",
            projectId: "logistik-tracker-app",
            storageBucket: "logistik-tracker-app.firebasestorage.app",
            messagingSenderId: "417931787688",
            appId: "1:417931787688:web:e0dedef7fb2acfc33ab19d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'my-trading-v1';

        const TRUCK_TYPES = ['CDD', 'TRONTON', 'DUMPTRUK', 'WINGBOX', 'KONTAINER', 'BOX', 'MOBIL PRIBADI'];

        // Default Coordinate Configuration (mm)
        const DEFAULT_COORDS = {
            date: { top: 35, left: 140, label: 'Tanggal' },
            nopol: { top: 42, left: 140, label: 'No Polisi' },
            customerName: { top: 52, left: 20, label: 'Nama Customer' },
            customerAddress: { top: 58, left: 20, label: 'Alamat Customer' },
            itemName: { top: 85, left: 15, label: 'Nama Barang' },
            qty: { top: 85, left: 100, label: 'Quantity' },
            uom: { top: 85, left: 130, label: 'Satuan' },
            notes: { top: 95, left: 15, label: 'Keterangan' },
            driver: { top: 125, left: 75, label: 'Nama Driver' }
        };

        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('transaction'); 
            const [loading, setLoading] = useState(true);
            const [trucks, setTrucks] = useState([]); 

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, async (u) => {
                    if (!u) await signInAnonymously(auth);
                    setUser(u);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const qT = query(collection(db, 'artifacts', appId, 'public', 'data', 'trucks'));
                const unsub = onSnapshot(qT, s => setTrucks(s.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => unsub();
            }, [user]);

            if (loading) return React.createElement('div', {className: "flex items-center justify-center h-screen bg-slate-50 font-mono text-blue-600 animate-pulse"}, "LOADING_TRADING_SYSTEM...");

            const menuItems = [
                {v: 'transaction', i: ClipboardList, l: 'Transaksi'},
                {v: 'history', i: History, l: 'Riwayat'},
                {v: 'recap', i: FileSpreadsheet, l: 'Rekap'}, 
                {v: 'register', i: Truck, l: 'Armada'},
                {v: 'customers', i: Users, l: 'Customer'},
                {v: 'items', i: Package, l: 'Barang'}
            ];

            return (
                React.createElement("div", { className: "min-h-screen bg-slate-100 flex flex-col" },
                    React.createElement("header", { className: "bg-blue-800 text-white shadow-lg sticky top-0 z-20 no-print" },
                        React.createElement("div", { className: "max-w-6xl mx-auto px-4" },
                            React.createElement("div", { className: "flex items-center justify-between h-16" },
                                React.createElement("div", { className: "flex items-center gap-2 shrink-0" },
                                    React.createElement(TrendingUp, { size: 24 }),
                                    React.createElement("h1", { className: "text-lg font-bold hidden sm:block" }, "My Trading"),
                                    React.createElement("h1", { className: "text-lg font-bold sm:hidden" }, "MT")
                                ),
                                
                                React.createElement("div", { className: "flex-1 flex justify-center px-4 overflow-x-auto hide-scrollbar" },
                                    React.createElement("div", { className: "flex items-center gap-1 sm:gap-4" },
                                        menuItems.map(item => (
                                            React.createElement("button", { 
                                                key: item.v, 
                                                onClick: () => setView(item.v),
                                                className: `flex items-center gap-1.5 px-3 py-2 rounded-lg transition-all whitespace-nowrap ${view === item.v ? 'bg-blue-700 text-white shadow-inner' : 'text-blue-200 hover:text-white hover:bg-blue-700/50'}`
                                            }, 
                                                React.createElement(item.i, { size: 18 }),
                                                React.createElement("span", { className: "text-xs font-bold uppercase" }, item.l)
                                            )
                                        ))
                                    )
                                ),

                                React.createElement("button", { onClick: () => setView('settings'), className: `p-2 rounded-full transition-colors ${view === 'settings' ? 'bg-blue-700' : 'hover:bg-blue-700'}` }, 
                                    React.createElement(Settings, { size: 20 })
                                )
                            )
                        )
                    ),

                    React.createElement("main", { className: "max-w-4xl mx-auto p-4 md:pt-8 flex-1 w-full" },
                        view === 'register' && React.createElement(RegisterTruckForm, { user, trucks }),
                        view === 'customers' && React.createElement(MasterCustomerForm, { user }),
                        view === 'items' && React.createElement(MasterItemForm, { user }),
                        view === 'transaction' && React.createElement(TransactionForm, { user, trucks }),
                        view === 'history' && React.createElement(TransactionHistory, { user }),
                        view === 'recap' && React.createElement(RecapPage, { user }),
                        view === 'settings' && React.createElement(SettingsPage, { user })
                    ),

                    React.createElement("footer", { className: "bg-white border-t p-4 text-center text-slate-400 text-xs no-print mt-auto" },
                        React.createElement("p", null, `Â© ${new Date().getFullYear()} My Trading System. All rights reserved.`)
                    )
                )
            );
        }

        const RecapPage = ({ user }) => {
            const [transactions, setTransactions] = useState([]);
            const [filter, setFilter] = useState({ 
                startDate: new Date().toISOString().split('T')[0], 
                endDate: new Date().toISOString().split('T')[0] 
            });

            useEffect(() => {
                if (!user) return;
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'transactions'));
                const unsub = onSnapshot(q, s => {
                    const data = s.docs.map(d => ({id: d.id, ...d.data()}));
                    setTransactions(data.sort((a,b) => new Date(b.date) - new Date(a.date)));
                });
                return () => unsub();
            }, [user]);

            const filteredData = transactions.filter(t => {
                return t.date >= filter.startDate && t.date <= filter.endDate;
            });

            const downloadExcel = () => {
                if(filteredData.length === 0) return alert("Tidak ada data untuk didownload");

                const dataForExcel = filteredData.map(row => ({
                    "Tanggal": row.date,
                    "No Polisi": row.nopol,
                    "Driver": row.driver,
                    "No HP": row.noHp || '-',
                    "Customer": row.customerName,
                    "Alamat Customer": row.customerAddress || '',
                    "Barang": row.itemName,
                    "Qty": Number(row.qty), 
                    "Satuan": row.uom,
                    "Status": row.status === 'COMPLETED' ? 'Selesai' : 'Dalam Perjalanan',
                    "Keterangan": row.notes || ''
                }));

                const ws = window.XLSX.utils.json_to_sheet(dataForExcel);
                const wscols = [
                    {wch: 12}, {wch: 15}, {wch: 20}, {wch: 15}, 
                    {wch: 25}, {wch: 40}, {wch: 20}, {wch: 10}, 
                    {wch: 10}, {wch: 15}, {wch: 30}
                ];
                ws['!cols'] = wscols;
                const wb = window.XLSX.utils.book_new();
                window.XLSX.utils.book_append_sheet(wb, ws, "Rekap Transaksi");
                window.XLSX.writeFile(wb, `Rekap_Transaksi_${filter.startDate}_sd_${filter.endDate}.xlsx`);
            };

            return React.createElement("div", { className: "space-y-6 no-print" },
                React.createElement("div", { className: "bg-white p-6 rounded-xl border shadow-sm" },
                    React.createElement("h2", { className: "font-bold mb-4 flex gap-2 items-center" }, 
                        React.createElement(FileSpreadsheet, { className: "text-green-600" }), " Rekapitulasi Data"
                    ),
                    
                    React.createElement("div", { className: "flex flex-col md:flex-row gap-4 items-end mb-6" },
                        React.createElement("div", { className: "w-full" },
                            React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "DARI TANGGAL"),
                            React.createElement("input", { type: "date", className: "w-full p-2 border rounded-lg", value: filter.startDate, onChange: e => setFilter({...filter, startDate: e.target.value}) })
                        ),
                        React.createElement("div", { className: "w-full" },
                            React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "SAMPAI TANGGAL"),
                            React.createElement("input", { type: "date", className: "w-full p-2 border rounded-lg", value: filter.endDate, onChange: e => setFilter({...filter, endDate: e.target.value}) })
                        ),
                        React.createElement("button", { onClick: downloadExcel, className: "w-full md:w-auto bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 flex gap-2 items-center justify-center transition-all shadow-md active:scale-95" }, 
                            React.createElement(Download, { size: 18 }), "Download .XLSX"
                        )
                    ),

                    React.createElement("div", { className: "overflow-x-auto border rounded-lg" },
                        React.createElement("table", { className: "w-full text-xs text-left" },
                            React.createElement("thead", { className: "bg-slate-100 text-slate-600 uppercase font-bold" },
                                React.createElement("tr", null,
                                    React.createElement("th", { className: "p-3 border-b" }, "Tanggal"),
                                    React.createElement("th", { className: "p-3 border-b" }, "Nopol"),
                                    React.createElement("th", { className: "p-3 border-b" }, "Driver"),
                                    React.createElement("th", { className: "p-3 border-b" }, "No HP"),
                                    React.createElement("th", { className: "p-3 border-b" }, "Customer"),
                                    React.createElement("th", { className: "p-3 border-b" }, "Barang"),
                                    React.createElement("th", { className: "p-3 border-b text-right" }, "Qty"),
                                    React.createElement("th", { className: "p-3 border-b" }, "Status"),
                                    React.createElement("th", { className: "p-3 border-b" }, "Keterangan")
                                )
                            ),
                            React.createElement("tbody", null,
                                filteredData.length === 0 ? 
                                React.createElement("tr", null, React.createElement("td", { colSpan: 9, className: "p-8 text-center text-slate-400" }, "Tidak ada data pada periode ini.")) :
                                filteredData.map(row => 
                                    React.createElement("tr", { key: row.id, className: "hover:bg-slate-50 border-b last:border-0" },
                                        React.createElement("td", { className: "p-3" }, row.date),
                                        React.createElement("td", { className: "p-3 font-bold" }, row.nopol),
                                        React.createElement("td", { className: "p-3" }, row.driver),
                                        React.createElement("td", { className: "p-3 text-slate-500" }, row.noHp || '-'),
                                        React.createElement("td", { className: "p-3" }, row.customerName),
                                        React.createElement("td", { className: "p-3" }, row.itemName),
                                        React.createElement("td", { className: "p-3 text-right font-bold" }, `${row.qty} ${row.uom}`),
                                        React.createElement("td", { className: "p-3" }, 
                                            React.createElement("span", { className: `px-2 py-1 rounded text-[10px] font-bold ${row.status === 'COMPLETED' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}` }, 
                                                row.status
                                            )
                                        ),
                                        React.createElement("td", { className: "p-3 italic text-slate-500 max-w-xs truncate" }, row.notes || '-')
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        const TransactionForm = ({ user, trucks }) => {
            const [customers, setCustomers] = useState([]);
            const [items, setItems] = useState([]);
            const [activeTrans, setActiveTrans] = useState([]);
            const [printConfig, setPrintConfig] = useState(DEFAULT_COORDS);
            const [waConfig, setWaConfig] = useState({ token: '', targetGroups: '' });
            
            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                truckId: '',
                customerId: '',
                itemId: '',
                qty: '',
                uom: '',
                notes: ''
            });

            const [previewData, setPreviewData] = useState(null);
            const [printMode, setPrintMode] = useState('full'); 

            useEffect(() => {
                if (!user) return;
                const qC = query(collection(db, 'artifacts', appId, 'public', 'data', 'customers'));
                const qI = query(collection(db, 'artifacts', appId, 'public', 'data', 'items'));
                const qTr = query(collection(db, 'artifacts', appId, 'public', 'data', 'transactions'));
                
                // Load Settings
                const loadSettings = async () => {
                    const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'global'));
                    if (snap.exists()) {
                        const data = snap.data();
                        if (data.printConfig) setPrintConfig(data.printConfig);
                        if (data.waConfig) setWaConfig(data.waConfig);
                    }
                };
                loadSettings();

                const unsubs = [
                    onSnapshot(qC, s => setCustomers(s.docs.map(d => ({id: d.id, ...d.data()})))),
                    onSnapshot(qI, s => setItems(s.docs.map(d => ({id: d.id, ...d.data()})))),
                    onSnapshot(qTr, s => setActiveTrans(s.docs.map(d => ({id: d.id, ...d.data()})).filter(t => t.status === 'ACTIVE')))
                ];
                return () => unsubs.forEach(u => u());
            }, [user]);

            const handleSubmit = (e) => {
                e.preventDefault();
                const truck = trucks.find(t => t.id === formData.truckId);
                const customer = customers.find(c => c.id === formData.customerId);
                const item = items.find(i => i.id === formData.itemId);

                setPreviewData({
                    ...formData,
                    nopol: truck?.nopol,
                    driver: truck?.driver,
                    noHp: truck?.noHp || '-',
                    customerName: customer?.name,
                    customerAddress: customer?.address,
                    itemName: item?.name,
                    uom: formData.uom || item?.uom
                });
            };

            const sendWhatsAppNotification = async (data) => {
                if (!waConfig.token || !waConfig.targetGroups) return;

                const message = `Trading
ðŸ”” *LAPORAN TRANSAKSI KIRIMAN*
ðŸ“… *Tgl* : ${data.date}
ðŸ”„ *Tipe* : Cetak SPJ
ðŸ‘¤ *User* : Admin

ðŸ“„ *No. POL* : ${data.nopol}
      *Driver* : ${data.driver}
      *Tlp* : ${data.noHp}
ðŸ“ *Tujuan* : ${data.customerName}

*Rincian Produk*
--------------------------------
1. ${data.itemName}
   ðŸ“¦ ${data.qty} ${data.uom}
${data.notes ? `   ðŸ“ Ket: ${data.notes}` : ''}

> _Sent via fonnte.com_`;

                const groups = waConfig.targetGroups.split(',').map(g => g.trim()).filter(g => g);

                for (const groupId of groups) {
                    try {
                        const formData = new FormData();
                        formData.append("target", groupId);
                        formData.append("message", message);

                        await fetch("https://api.fonnte.com/send", {
                            method: "POST",
                            headers: {
                                Authorization: waConfig.token,
                            },
                            body: formData,
                        });
                    } catch (error) {
                        console.error("Gagal kirim WA ke " + groupId, error);
                    }
                }
            };

            const confirmAndSave = async () => {
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'transactions'), {
                        ...previewData,
                        status: 'ACTIVE',
                        timestamp: serverTimestamp(),
                        createdBy: user.uid
                    });
                    
                    // Send WA
                    sendWhatsAppNotification(previewData);

                    window.print();
                    setPreviewData(null);
                    setFormData({...formData, truckId: '', qty: '', notes: ''});
                } catch (err) {
                    console.error(err);
                    alert("Terjadi kesalahan saat menyimpan.");
                }
            };

            // Helper for inline styles
            const getPosStyle = (key) => ({
                position: 'absolute',
                top: `${printConfig[key]?.top || 0}mm`,
                left: `${printConfig[key]?.left || 0}mm`
            });

            return React.createElement("div", null,
                React.createElement("div", { className: "bg-white p-6 rounded-xl border shadow-sm no-print" },
                    React.createElement("h2", { className: "text-lg font-bold mb-6 flex items-center gap-2 border-b pb-4" }, 
                        React.createElement(ClipboardList, { className: "text-blue-500" }), " Buat Transaksi Baru"
                    ),
                    React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                            React.createElement("div", null,
                                React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "TANGGAL"),
                                React.createElement("input", { type: "date", required: true, className: "w-full p-2 border rounded-lg bg-slate-50", value: formData.date, onChange: e => setFormData({...formData, date: e.target.value}) })
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "TRUK / DRIVER"),
                                React.createElement("select", { required: true, className: "w-full p-2 border rounded-lg", value: formData.truckId, onChange: e => setFormData({...formData, truckId: e.target.value}) },
                                    React.createElement("option", { value: "" }, "- Pilih Armada -"),
                                    trucks.filter(t => !activeTrans.some(at => at.truckId === t.id)).map(t => 
                                        React.createElement("option", { key: t.id, value: t.id }, `${t.nopol} - ${t.driver}`)
                                    )
                                )
                            )
                        ),
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                            React.createElement("div", null,
                                React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "TUJUAN / CUSTOMER"),
                                React.createElement("select", { required: true, className: "w-full p-2 border rounded-lg", value: formData.customerId, onChange: e => setFormData({...formData, customerId: e.target.value}) },
                                    React.createElement("option", { value: "" }, "- Pilih Customer -"),
                                    customers.map(c => React.createElement("option", { key: c.id, value: c.id }, c.name))
                                )
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "BARANG"),
                                React.createElement("select", { 
                                    required: true, 
                                    className: "w-full p-2 border rounded-lg", 
                                    value: formData.itemId, 
                                    onChange: e => {
                                        const selectedItemId = e.target.value;
                                        const selectedItem = items.find(i => i.id === selectedItemId);
                                        setFormData({
                                            ...formData, 
                                            itemId: selectedItemId,
                                            uom: selectedItem ? selectedItem.uom : '' 
                                        });
                                    }
                                },
                                    React.createElement("option", { value: "" }, "- Pilih Barang -"),
                                    items.map(i => React.createElement("option", { key: i.id, value: i.id }, i.name))
                                )
                            )
                        ),
                        React.createElement("div", { className: "grid grid-cols-2 gap-4" },
                            React.createElement("div", null,
                                React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "QTY"),
                                React.createElement("input", { type: "number", required: true, className: "w-full p-2 border rounded-lg", value: formData.qty, onChange: e => setFormData({...formData, qty: e.target.value}) })
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "SATUAN (OPSIONAL)"),
                                React.createElement("input", { type: "text", className: "w-full p-2 border rounded-lg", placeholder: "Contoh: Pallet/Box", value: formData.uom, onChange: e => setFormData({...formData, uom: e.target.value}) })
                            )
                        ),
                        React.createElement("div", null,
                            React.createElement("label", { className: "text-xs font-bold text-slate-500" }, "KETERANGAN TAMBAHAN"),
                            React.createElement("textarea", { 
                                className: "w-full p-2 border rounded-lg", 
                                rows: 2,
                                placeholder: "Contoh: Titip di Satpam / Barang fragile",
                                value: formData.notes, 
                                onChange: e => setFormData({...formData, notes: e.target.value}) 
                            })
                        ),
                        React.createElement("button", { type: "submit", className: "w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700 transition-all" }, "Preview & Cetak")
                    )
                ),

                previewData && React.createElement("div", { className: "fixed inset-0 z-50 flex items-center justify-center p-4 preview-modal no-print" },
                    React.createElement("div", { className: "bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]" },
                        React.createElement("div", { className: "p-4 bg-slate-800 text-white flex justify-between items-center" },
                            React.createElement("div", { className: "flex items-center gap-2" },
                                React.createElement(Eye, { size: 20 }),
                                React.createElement("h3", { className: "font-bold" }, "Preview Nota Transaksi")
                            ),
                            React.createElement("button", { onClick: () => setPreviewData(null) }, React.createElement(X, { size: 24 }))
                        ),
                        React.createElement("div", { className: "p-4 bg-slate-100 border-b flex gap-4" },
                            React.createElement("label", { className: `flex-1 p-3 rounded-xl border-2 cursor-pointer flex flex-col items-center gap-1 transition-all ${printMode === 'full' ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-200 bg-white'}` },
                                React.createElement("input", { type: "radio", className: "hidden", name: "pmode", checked: printMode === 'full', onChange: () => setPrintMode('full') }),
                                React.createElement(FileText, { size: 20 }),
                                React.createElement("span", { className: "text-xs font-bold" }, "Template Lengkap")
                            ),
                            React.createElement("label", { className: `flex-1 p-3 rounded-xl border-2 cursor-pointer flex flex-col items-center gap-1 transition-all ${printMode === 'data-only' ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-200 bg-white'}` },
                                React.createElement("input", { type: "radio", className: "hidden", name: "pmode", checked: printMode === 'data-only', onChange: () => setPrintMode('data-only') }),
                                React.createElement(AlignJustify, { size: 20 }),
                                React.createElement("span", { className: "text-xs font-bold" }, "Hanya Isi Data (Blangko)")
                            )
                        ),
                        React.createElement("div", { className: "flex-1 overflow-auto p-8" },
                            React.createElement("div", { className: `mx-auto border bg-white shadow-sm p-6 ${printMode === 'data-only' ? 'font-print border-dashed text-blue-500' : 'text-black'}` },
                                printMode === 'full' ? 
                                React.createElement("div", null,
                                    React.createElement("div", { className: "flex justify-between border-b-2 border-black pb-2 mb-4" },
                                        React.createElement("div", null, React.createElement("h4", { className: "font-black italic text-xl" }, "MY TRADING"), React.createElement("p", {className:"text-[10px]"}, "Professional Trading & Logistics")),
                                        React.createElement("h4", { className: "font-bold text-lg" }, "NOTA TRANSAKSI")
                                    ),
                                    React.createElement("div", { className: "grid grid-cols-2 text-[11px] mb-4" },
                                        React.createElement("div", null, React.createElement("p", null, "Kepada:"), React.createElement("p", {className:"font-bold"}, previewData.customerName), React.createElement("p", null, previewData.customerAddress)),
                                        React.createElement("div", { className: "text-right" }, 
                                            React.createElement("p", null, "Tanggal: ", previewData.date), 
                                            React.createElement("p", null, "No. Polisi: ", previewData.nopol), 
                                            React.createElement("p", null, "Driver: ", previewData.driver),
                                            React.createElement("p", null, "HP: ", previewData.noHp)
                                        )
                                    ),
                                    React.createElement("table", { className: "w-full border-collapse border border-black text-xs mb-1" },
                                        React.createElement("thead", { className: "bg-slate-100" },
                                            React.createElement("tr", null,
                                                React.createElement("th", {className:"border border-black p-1"}, "NAMA BARANG"),
                                                React.createElement("th", {className:"border border-black p-1"}, "JUMLAH"),
                                                React.createElement("th", {className:"border border-black p-1"}, "SATUAN")
                                            )
                                        ),
                                        React.createElement("tbody", null,
                                            React.createElement("tr", null,
                                                React.createElement("td", {className:"border border-black p-1"}, previewData.itemName),
                                                React.createElement("td", {className:"border border-black p-1 text-center font-bold text-lg"}, previewData.qty),
                                                React.createElement("td", {className:"border border-black p-1 text-center"}, previewData.uom)
                                            )
                                        )
                                    ),
                                    previewData.notes && React.createElement("div", { className: "p-2 bg-slate-50 border border-t-0 text-[10px] italic border-black mb-10" }, 
                                        "Ket: ", previewData.notes
                                    )
                                ) : 
                                React.createElement("div", { className: "spj-blanko-data font-print text-lg text-black" },
                                    React.createElement("div", { style: getPosStyle('date') }, previewData.date),
                                    React.createElement("div", { style: getPosStyle('nopol') }, previewData.nopol),
                                    React.createElement("div", { style: { ...getPosStyle('customerName'), fontWeight: 'bold' } }, previewData.customerName),
                                    React.createElement("div", { style: { ...getPosStyle('customerAddress'), fontSize: '12px', width: '80mm' } }, previewData.customerAddress),
                                    
                                    React.createElement("div", { style: getPosStyle('itemName') }, previewData.itemName),
                                    React.createElement("div", { style: { ...getPosStyle('qty'), fontWeight: 'bold' } }, previewData.qty),
                                    React.createElement("div", { style: getPosStyle('uom') }, previewData.uom),

                                    React.createElement("div", { style: { ...getPosStyle('notes'), fontSize: '14px', fontStyle: 'italic' } }, 
                                       previewData.notes ? `Ket: ${previewData.notes}` : ''
                                    ),

                                    React.createElement("div", { style: { ...getPosStyle('driver'), textAlign: 'center', width: '50mm' } }, previewData.driver)
                                )
                            )
                        ),
                        React.createElement("div", { className: "p-4 bg-slate-50 flex gap-4" },
                            React.createElement("button", { onClick: confirmAndSave, className: "flex-1 bg-green-600 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2" }, 
                                React.createElement(Printer, { size: 18 }), "KONFIRMASI & CETAK"
                            )
                        )
                    )
                ),

                previewData && React.createElement("div", { className: "hidden print:block print-area" },
                    printMode === 'full' ? 
                    React.createElement("div", { className: "p-10 text-black h-screen" },
                        React.createElement("div", { className: "flex justify-between border-b-4 border-double border-black pb-4 mb-6" },
                            React.createElement("div", null, 
                                React.createElement("h1", { className: "text-3xl font-black italic" }, "MY TRADING"),
                                React.createElement("p", { className: "text-xs" }, "Sistem Manajemen Perdagangan Digital")
                            ),
                            React.createElement("h2", { className: "text-2xl font-bold self-end" }, "NOTA TRANSAKSI")
                        ),
                        React.createElement("div", { className: "grid grid-cols-2 mb-8 gap-10" },
                            React.createElement("div", null, 
                                React.createElement("p", { className: "text-sm border-b mb-1 font-bold" }, "PENERIMA:"),
                                React.createElement("p", { className: "text-lg font-bold" }, previewData.customerName),
                                React.createElement("p", { className: "text-sm leading-tight" }, previewData.customerAddress)
                            ),
                            React.createElement("div", { className: "text-right space-y-1" },
                                React.createElement("p", null, "Tanggal: ", React.createElement("span", {className:"font-bold"}, previewData.date)),
                                React.createElement("p", null, "No. Kendaraan: ", React.createElement("span", {className:"font-bold"}, previewData.nopol)),
                                React.createElement("p", null, "Sopir: ", React.createElement("span", {className:"font-bold"}, previewData.driver)),
                                React.createElement("p", null, "No HP: ", React.createElement("span", {className:"font-bold"}, previewData.noHp))
                            )
                        ),
                        React.createElement("table", { className: "w-full border-collapse border border-black" },
                            React.createElement("thead", null,
                                React.createElement("tr", { className: "bg-gray-100" },
                                    React.createElement("th", { className: "border border-black p-3 text-left" }, "DESKRIPSI BARANG"),
                                    React.createElement("th", { className: "border border-black p-3 text-center w-32" }, "QTY"),
                                    React.createElement("th", { className: "border border-black p-3 text-center w-32" }, "SATUAN")
                                )
                            ),
                            React.createElement("tbody", null,
                                React.createElement("tr", null,
                                    React.createElement("td", { className: "border border-black p-4" }, previewData.itemName),
                                    React.createElement("td", { className: "border border-black p-4 text-center font-bold text-2xl" }, previewData.qty),
                                    React.createElement("td", { className: "border border-black p-4 text-center" }, previewData.uom)
                                )
                            )
                        ),
                        React.createElement("div", { className: "p-2 border border-black border-t-0 text-xs italic mb-20" }, 
                            "Keterangan: ", previewData.notes || "-"
                        ),
                        React.createElement("div", { className: "grid grid-cols-3 text-center text-xs" },
                            ['Hormat Kami', 'Sopir', 'Penerima'].map(pos => (
                                React.createElement("div", { key: pos }, 
                                    React.createElement("p", { className: "mb-20 uppercase font-bold" }, pos),
                                    React.createElement("div", { className: "border-b border-black w-2/3 mx-auto" }),
                                    React.createElement("p", { className: "mt-1 italic" }, pos === 'Sopir' ? `(${previewData.driver})` : '(....................)')
                                )
                            ))
                        )
                    ) : 
                    React.createElement("div", { className: "spj-blanko-data font-print text-lg text-black" },
                        React.createElement("div", { style: getPosStyle('date') }, previewData.date),
                        React.createElement("div", { style: getPosStyle('nopol') }, previewData.nopol),
                        React.createElement("div", { style: { ...getPosStyle('customerName'), fontWeight: 'bold' } }, previewData.customerName),
                        React.createElement("div", { style: { ...getPosStyle('customerAddress'), fontSize: '12px', width: '80mm' } }, previewData.customerAddress),
                        
                        React.createElement("div", { style: getPosStyle('itemName') }, previewData.itemName),
                        React.createElement("div", { style: { ...getPosStyle('qty'), fontWeight: 'bold' } }, previewData.qty),
                        React.createElement("div", { style: getPosStyle('uom') }, previewData.uom),

                        React.createElement("div", { style: { ...getPosStyle('notes'), fontSize: '14px', fontStyle: 'italic' } }, 
                           previewData.notes ? `Ket: ${previewData.notes}` : ''
                        ),

                        React.createElement("div", { style: { ...getPosStyle('driver'), textAlign: 'center', width: '50mm' } }, previewData.driver)
                    )
                )
            );
        };

        const TransactionHistory = ({ user }) => {
            const [transactions, setTransactions] = useState([]);
            useEffect(() => {
                if (!user) return;
                const unsub = onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'transactions')), s => {
                    const data = s.docs.map(d => ({id: d.id, ...d.data()}));
                    setTransactions(data.sort((a,b) => (b.timestamp?.seconds||0) - (a.timestamp?.seconds||0)));
                }, (err) => console.error(err));
                return () => unsub();
            }, [user]);

            const handleFinish = async (id) => {
                if(!confirm("Selesaikan transaksi ini? Armada akan kembali tersedia.")) return;
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'transactions', id), { status: 'COMPLETED', completedAt: serverTimestamp() });
            };

            return React.createElement("div", { className: "space-y-3 no-print" },
                React.createElement("h2", { className: "font-bold text-lg flex gap-2 items-center" }, React.createElement(History, { className: "text-blue-500" }), " Log Perjalanan / Transaksi"),
                transactions.length === 0 ? 
                    React.createElement("p", {className: "text-center text-slate-400 py-10"}, "Belum ada riwayat transaksi.") :
                    transactions.map(t => React.createElement("div", { key: t.id, className: `bg-white p-4 rounded-xl border shadow-sm flex justify-between items-center ${t.status === 'ACTIVE' ? 'border-l-4 border-l-orange-500' : 'opacity-60'}` },
                        React.createElement("div", null,
                            React.createElement("p", { className: "font-black text-lg" }, t.nopol),
                            React.createElement("p", { className: "text-sm font-bold text-slate-600" }, t.customerName),
                            React.createElement("p", { className: "text-xs text-blue-600" }, t.itemName, " - ", t.qty, " ", t.uom),
                            t.notes && React.createElement("p", { className: "text-[10px] text-slate-400 italic" }, "Ket: ", t.notes)
                        ),
                        t.status === 'ACTIVE' && React.createElement("button", { onClick: () => handleFinish(t.id), className: "bg-orange-500 text-white text-xs px-4 py-2 rounded-lg font-bold hover:bg-orange-600 transition-colors" }, "SELESAI")
                    ))
            );
        };

        const MasterCustomerForm = ({ user }) => {
            const [formData, setFormData] = useState({ name: '', address: '' });
            const [customers, setCustomers] = useState([]);
            const [editingId, setEditingId] = useState(null);
            const [editData, setEditData] = useState({});

            useEffect(() => {
                if (!user) return;
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'customers'));
                const unsub = onSnapshot(q, s => setCustomers(s.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => unsub();
            }, [user]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'customers'), { ...formData, createdAt: serverTimestamp() });
                setFormData({ name: '', address: '' });
            };

            const startEdit = (c) => {
                setEditingId(c.id);
                setEditData(c);
            };

            const saveEdit = async () => {
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'customers', editingId), {
                        name: editData.name,
                        address: editData.address
                    });
                    setEditingId(null);
                } catch (err) {
                    console.error("Gagal update customer:", err);
                    alert("Gagal update data");
                }
            };

            const deleteCustomer = async (id) => {
                if(confirm("Hapus customer ini?")) {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'customers', id));
                }
            };

            return React.createElement("div", { className: "space-y-6 no-print" },
                React.createElement("div", { className: "bg-white p-6 rounded-xl border" },
                    React.createElement("h2", { className: "font-bold mb-4 flex gap-2 items-center" }, React.createElement(Users, { className: "text-blue-500" }), " Data Customer"),
                    React.createElement("form", { onSubmit: handleSubmit, className: "space-y-3" },
                        React.createElement("input", { required: true, placeholder: "Nama Perusahaan / Toko", className: "w-full p-2 border rounded-lg", value: formData.name, onChange: e => setFormData({...formData, name: e.target.value}) }),
                        React.createElement("textarea", { placeholder: "Alamat Lengkap", className: "w-full p-2 border rounded-lg", value: formData.address, onChange: e => setFormData({...formData, address: e.target.value}) }),
                        React.createElement("button", { className: "w-full bg-slate-800 text-white p-2 rounded-lg font-bold hover:bg-black transition-colors" }, "Simpan Customer")
                    )
                ),
                React.createElement("div", { className: "bg-white p-6 rounded-xl border shadow-sm" },
                    React.createElement("h3", { className: "font-bold mb-4" }, "Daftar Customer"),
                    React.createElement("div", { className: "overflow-x-auto" },
                        React.createElement("table", { className: "w-full text-sm text-left" },
                            React.createElement("thead", { className: "bg-slate-50 text-slate-500 uppercase font-bold" },
                                React.createElement("tr", null,
                                    React.createElement("th", { className: "p-3" }, "Nama"),
                                    React.createElement("th", { className: "p-3" }, "Alamat"),
                                    React.createElement("th", { className: "p-3 text-right" }, "Aksi")
                                )
                            ),
                            React.createElement("tbody", null,
                                customers.length === 0 ? 
                                React.createElement("tr", null, React.createElement("td", { colSpan: 3, className: "p-4 text-center text-slate-400" }, "Belum ada customer.")) :
                                customers.map(c => 
                                    editingId === c.id ?
                                    React.createElement("tr", { key: c.id, className: "border-b bg-blue-50" },
                                        React.createElement("td", { className: "p-2" }, React.createElement("input", { className: "w-full p-1 border rounded", value: editData.name, onChange: e => setEditData({...editData, name: e.target.value}) })),
                                        React.createElement("td", { className: "p-2" }, React.createElement("input", { className: "w-full p-1 border rounded", value: editData.address, onChange: e => setEditData({...editData, address: e.target.value}) })),
                                        React.createElement("td", { className: "p-2 text-right flex justify-end gap-2" },
                                            React.createElement("button", { onClick: saveEdit, className: "p-1 bg-green-500 text-white rounded" }, React.createElement(CheckCircle, { size: 16 })),
                                            React.createElement("button", { onClick: () => setEditingId(null), className: "p-1 bg-red-400 text-white rounded" }, React.createElement(X, { size: 16 }))
                                        )
                                    ) :
                                    React.createElement("tr", { key: c.id, className: "border-b hover:bg-slate-50" },
                                        React.createElement("td", { className: "p-3 font-bold" }, c.name),
                                        React.createElement("td", { className: "p-3" }, c.address),
                                        React.createElement("td", { className: "p-3 text-right flex justify-end gap-2" },
                                            React.createElement("button", { onClick: () => startEdit(c), className: "text-blue-500 hover:text-blue-700" }, React.createElement(Pencil, { size: 16 })),
                                            React.createElement("button", { onClick: () => deleteCustomer(c.id), className: "text-red-400 hover:text-red-600" }, React.createElement(Trash2, { size: 16 }))
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        const MasterItemForm = ({ user }) => {
            const [formData, setFormData] = useState({ name: '', uom: 'PCS' });
            const [items, setItems] = useState([]);
            const [editingId, setEditingId] = useState(null);
            const [editData, setEditData] = useState({});

            useEffect(() => {
                if (!user) return;
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'items'));
                const unsub = onSnapshot(q, s => setItems(s.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => unsub();
            }, [user]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'items'), { ...formData, createdAt: serverTimestamp() });
                setFormData({ name: '', uom: 'PCS' });
            };

            const startEdit = (item) => {
                setEditingId(item.id);
                setEditData(item);
            };

            const saveEdit = async () => {
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'items', editingId), {
                        name: editData.name,
                        uom: editData.uom
                    });
                    setEditingId(null);
                } catch (err) {
                    console.error("Gagal update barang:", err);
                    alert("Gagal update data");
                }
            };

            const deleteItem = async (id) => {
                if(confirm("Hapus barang ini?")) {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'items', id));
                }
            };

            return React.createElement("div", { className: "space-y-6 no-print" },
                React.createElement("div", { className: "bg-white p-6 rounded-xl border" },
                    React.createElement("h2", { className: "font-bold mb-4 flex gap-2 items-center" }, React.createElement(Package, { className: "text-blue-500" }), " Data Barang Dagangan"),
                    React.createElement("form", { onSubmit: handleSubmit, className: "space-y-3" },
                        React.createElement("input", { required: true, placeholder: "Nama Barang", className: "w-full p-2 border rounded-lg", value: formData.name, onChange: e => setFormData({...formData, name: e.target.value}) }),
                        React.createElement("input", { required: true, placeholder: "Satuan Dasar (PCS/KG/Ltr)", className: "w-full p-2 border rounded-lg", value: formData.uom, onChange: e => setFormData({...formData, uom: e.target.value}) }),
                        React.createElement("button", { className: "w-full bg-slate-800 text-white p-2 rounded-lg font-bold hover:bg-black transition-colors" }, "Simpan Barang")
                    )
                ),
                React.createElement("div", { className: "bg-white p-6 rounded-xl border shadow-sm" },
                    React.createElement("h3", { className: "font-bold mb-4" }, "Daftar Barang"),
                    React.createElement("div", { className: "overflow-x-auto" },
                        React.createElement("table", { className: "w-full text-sm text-left" },
                            React.createElement("thead", { className: "bg-slate-50 text-slate-500 uppercase font-bold" },
                                React.createElement("tr", null,
                                    React.createElement("th", { className: "p-3" }, "Nama Barang"),
                                    React.createElement("th", { className: "p-3" }, "Satuan"),
                                    React.createElement("th", { className: "p-3 text-right" }, "Aksi")
                                )
                            ),
                            React.createElement("tbody", null,
                                items.length === 0 ? 
                                React.createElement("tr", null, React.createElement("td", { colSpan: 3, className: "p-4 text-center text-slate-400" }, "Belum ada barang.")) :
                                items.map(i => 
                                    editingId === i.id ?
                                    React.createElement("tr", { key: i.id, className: "border-b bg-blue-50" },
                                        React.createElement("td", { className: "p-2" }, React.createElement("input", { className: "w-full p-1 border rounded", value: editData.name, onChange: e => setEditData({...editData, name: e.target.value}) })),
                                        React.createElement("td", { className: "p-2" }, React.createElement("input", { className: "w-full p-1 border rounded", value: editData.uom, onChange: e => setEditData({...editData, uom: e.target.value}) })),
                                        React.createElement("td", { className: "p-2 text-right flex justify-end gap-2" },
                                            React.createElement("button", { onClick: saveEdit, className: "p-1 bg-green-500 text-white rounded" }, React.createElement(CheckCircle, { size: 16 })),
                                            React.createElement("button", { onClick: () => setEditingId(null), className: "p-1 bg-red-400 text-white rounded" }, React.createElement(X, { size: 16 }))
                                        )
                                    ) :
                                    React.createElement("tr", { key: i.id, className: "border-b hover:bg-slate-50" },
                                        React.createElement("td", { className: "p-3 font-bold" }, i.name),
                                        React.createElement("td", { className: "p-3" }, i.uom),
                                        React.createElement("td", { className: "p-3 text-right flex justify-end gap-2" },
                                            React.createElement("button", { onClick: () => startEdit(i), className: "text-blue-500 hover:text-blue-700" }, React.createElement(Pencil, { size: 16 })),
                                            React.createElement("button", { onClick: () => deleteItem(i.id), className: "text-red-400 hover:text-red-600" }, React.createElement(Trash2, { size: 16 }))
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        const RegisterTruckForm = ({ user, trucks }) => {
            const [formData, setFormData] = useState({ nopol: '', driver: '', noHp: '', type: 'SDD' });
            const [editingId, setEditingId] = useState(null);
            const [editData, setEditData] = useState({});

            const handleSubmit = async (e) => {
                e.preventDefault();
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'trucks'), { ...formData, nopol: formData.nopol.toUpperCase(), createdAt: serverTimestamp() });
                setFormData({ nopol: '', driver: '', noHp: '', type: 'SDD' });
            };

            const startEdit = (truck) => {
                setEditingId(truck.id);
                setEditData(truck);
            };

            const cancelEdit = () => {
                setEditingId(null);
                setEditData({});
            };

            const saveEdit = async () => {
                if(!editData.nopol || !editData.driver) return;
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'trucks', editingId), {
                        nopol: editData.nopol.toUpperCase(),
                        driver: editData.driver,
                        noHp: editData.noHp,
                        type: editData.type
                    });
                    setEditingId(null);
                } catch (err) {
                    console.error("Gagal update:", err);
                    alert("Gagal update data");
                }
            };

            const deleteTruck = async (id) => {
                if(confirm("Yakin hapus armada ini?")) {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'trucks', id));
                }
            };

            return React.createElement("div", { className: "space-y-6 no-print" },
                React.createElement("div", { className: "bg-white p-6 rounded-xl border shadow-sm" },
                    React.createElement("h2", { className: "font-bold mb-4 flex gap-2 items-center" }, React.createElement(PlusCircle, { className: "text-blue-500" }), " Registrasi Armada Pengiriman"),
                    React.createElement("form", { onSubmit: handleSubmit, className: "space-y-3" },
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
                            React.createElement("input", { required: true, placeholder: "No Polisi (Contoh: B 1234 XX)", className: "w-full p-2 border rounded-lg uppercase", value: formData.nopol, onChange: e => setFormData({...formData, nopol: e.target.value}) }),
                            React.createElement("select", { className: "w-full p-2 border rounded-lg", value: formData.type, onChange: e => setFormData({...formData, type: e.target.value}) }, 
                                TRUCK_TYPES.map(t => React.createElement("option", { key: t, value: t }, t))
                            )
                        ),
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
                            React.createElement("input", { required: true, placeholder: "Nama Driver", className: "w-full p-2 border rounded-lg", value: formData.driver, onChange: e => setFormData({...formData, driver: e.target.value}) }),
                            React.createElement("input", { type: "tel", placeholder: "No HP Driver", className: "w-full p-2 border rounded-lg", value: formData.noHp, onChange: e => setFormData({...formData, noHp: e.target.value}) })
                        ),
                        React.createElement("button", { className: "w-full bg-blue-600 text-white p-2 rounded-lg font-bold hover:bg-blue-700 transition-colors" }, "Simpan Armada")
                    )
                ),

                React.createElement("div", { className: "bg-white p-6 rounded-xl border shadow-sm" },
                    React.createElement("h2", { className: "font-bold mb-4 flex gap-2 items-center" }, React.createElement(Truck, { className: "text-blue-500" }), " Daftar Armada"),
                    React.createElement("div", { className: "overflow-x-auto" },
                        React.createElement("table", { className: "w-full text-sm text-left" },
                            React.createElement("thead", { className: "bg-slate-50 text-slate-500 uppercase font-bold" },
                                React.createElement("tr", null,
                                    React.createElement("th", { className: "p-3" }, "No Polisi"),
                                    React.createElement("th", { className: "p-3" }, "Driver"),
                                    React.createElement("th", { className: "p-3" }, "No HP"),
                                    React.createElement("th", { className: "p-3" }, "Tipe"),
                                    React.createElement("th", { className: "p-3 text-right" }, "Aksi")
                                )
                            ),
                            React.createElement("tbody", null,
                                trucks.length === 0 ? 
                                React.createElement("tr", null, React.createElement("td", { colSpan: 5, className: "p-4 text-center text-slate-400" }, "Belum ada armada terdaftar.")) :
                                trucks.map(t => 
                                    editingId === t.id ? 
                                    React.createElement("tr", { key: t.id, className: "border-b bg-blue-50" },
                                        React.createElement("td", { className: "p-2" }, 
                                            React.createElement("input", { className: "w-full p-1 border rounded uppercase font-bold", value: editData.nopol, onChange: e => setEditData({...editData, nopol: e.target.value}) })
                                        ),
                                        React.createElement("td", { className: "p-2" }, 
                                            React.createElement("input", { className: "w-full p-1 border rounded", value: editData.driver, onChange: e => setEditData({...editData, driver: e.target.value}) })
                                        ),
                                        React.createElement("td", { className: "p-2" }, 
                                            React.createElement("input", { className: "w-full p-1 border rounded", value: editData.noHp, onChange: e => setEditData({...editData, noHp: e.target.value}) })
                                        ),
                                        React.createElement("td", { className: "p-2" }, 
                                            React.createElement("select", { className: "w-full p-1 border rounded", value: editData.type, onChange: e => setEditData({...editData, type: e.target.value}) },
                                                TRUCK_TYPES.map(type => React.createElement("option", { key: type, value: type }, type))
                                            )
                                        ),
                                        React.createElement("td", { className: "p-2 text-right flex justify-end gap-2" }, 
                                            React.createElement("button", { onClick: saveEdit, className: "p-1 bg-green-500 text-white rounded hover:bg-green-600" }, React.createElement(CheckCircle, { size: 16 })),
                                            React.createElement("button", { onClick: cancelEdit, className: "p-1 bg-red-400 text-white rounded hover:bg-red-500" }, React.createElement(X, { size: 16 }))
                                        )
                                    ) :
                                    React.createElement("tr", { key: t.id, className: "border-b hover:bg-slate-50" },
                                        React.createElement("td", { className: "p-3 font-bold" }, t.nopol),
                                        React.createElement("td", { className: "p-3" }, t.driver),
                                        React.createElement("td", { className: "p-3 text-slate-500" }, t.noHp || "-"),
                                        React.createElement("td", { className: "p-3" }, 
                                            React.createElement("span", { className: "bg-slate-200 px-2 py-1 rounded text-xs font-bold" }, t.type)
                                        ),
                                        React.createElement("td", { className: "p-3 text-right flex justify-end gap-2" }, 
                                            React.createElement("button", { onClick: () => startEdit(t), className: "text-blue-500 hover:text-blue-700" }, React.createElement(Pencil, { size: 16 })),
                                            React.createElement("button", { onClick: () => deleteTruck(t.id), className: "text-red-400 hover:text-red-600" }, React.createElement(Trash2, { size: 16 }))
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        const SettingsPage = ({ user }) => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [loginData, setLoginData] = useState({ username: '', password: '' });
            const [activeTab, setActiveTab] = useState('general');
            const [coords, setCoords] = useState(DEFAULT_COORDS);
            const [waConfig, setWaConfig] = useState({ token: '', targetGroups: '' });
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                if (!user) return;
                const loadSettings = async () => {
                    const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'global'));
                    if (snap.exists()) {
                        const data = snap.data();
                        if(data.printConfig) setCoords(data.printConfig);
                        if(data.waConfig) setWaConfig(data.waConfig);
                    }
                };
                loadSettings();
            }, [user]);

            const handleLogin = (e) => {
                e.preventDefault();
                if (loginData.username === 'admin' && loginData.password === 'admin123') {
                    setIsAuthenticated(true);
                } else {
                    alert("Username atau Password salah!");
                }
            };

            if (!isAuthenticated) {
                return React.createElement("div", { className: "max-w-md mx-auto mt-10 bg-white p-8 rounded-xl border shadow-sm" },
                    React.createElement("h2", { className: "text-xl font-bold text-center mb-6 flex items-center justify-center gap-2" }, 
                        React.createElement(Settings, { className: "text-blue-500" }), "Akses Pengaturan"
                    ),
                    React.createElement("form", { onSubmit: handleLogin, className: "space-y-4" },
                        React.createElement("div", null,
                            React.createElement("label", { className: "block text-sm font-bold text-slate-500 mb-1" }, "Username"),
                            React.createElement("input", { 
                                type: "text", 
                                className: "w-full p-2 border rounded-lg",
                                value: loginData.username,
                                onChange: e => setLoginData({...loginData, username: e.target.value})
                            })
                        ),
                        React.createElement("div", null,
                            React.createElement("label", { className: "block text-sm font-bold text-slate-500 mb-1" }, "Password"),
                            React.createElement("input", { 
                                type: "password", 
                                className: "w-full p-2 border rounded-lg",
                                value: loginData.password,
                                onChange: e => setLoginData({...loginData, password: e.target.value})
                            })
                        ),
                        React.createElement("button", { className: "w-full bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700" }, "Masuk")
                    )
                );
            }

            const saveSettings = async () => {
                setLoading(true);
                try {
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'global'), {
                        printConfig: coords,
                        waConfig: waConfig,
                        updatedAt: serverTimestamp()
                    }, { merge: true });
                    alert("Pengaturan Berhasil Disimpan!");
                } catch (err) {
                    console.error(err);
                    alert("Gagal menyimpan");
                }
                setLoading(false);
            };

            return React.createElement("div", { className: "bg-white p-6 rounded-xl border shadow-sm no-print space-y-6" },
                React.createElement("h2", { className: "text-lg font-bold flex items-center gap-2 border-b pb-4" }, 
                    React.createElement(Settings, { className: "text-blue-500" }), " Pengaturan Aplikasi"
                ),
                
                React.createElement("div", { className: "flex gap-2 border-b" },
                    React.createElement("button", { onClick: () => setActiveTab('general'), className: `px-4 py-2 border-b-2 font-bold ${activeTab === 'general' ? 'border-blue-500 text-blue-600' : 'border-transparent text-slate-400'}` }, "Umum"),
                    React.createElement("button", { onClick: () => setActiveTab('wa'), className: `px-4 py-2 border-b-2 font-bold ${activeTab === 'wa' ? 'border-blue-500 text-blue-600' : 'border-transparent text-slate-400'}` }, "WhatsApp"),
                    React.createElement("button", { onClick: () => setActiveTab('print'), className: `px-4 py-2 border-b-2 font-bold ${activeTab === 'print' ? 'border-blue-500 text-blue-600' : 'border-transparent text-slate-400'}` }, "Kalibrasi Cetak")
                ),

                activeTab === 'general' && React.createElement("div", { className: "text-center py-8" },
                    React.createElement(TrendingUp, { className: "text-blue-200 mx-auto mb-4", size: 48 }),
                    React.createElement("h3", {className: "font-bold text-lg"}, "My Trading v1.2"),
                    React.createElement("p", { className: "text-slate-500 text-sm" }, "Sistem Manajemen Transaksi & Logistik Terpadu")
                ),

                activeTab === 'wa' && React.createElement("div", { className: "space-y-4" },
                    React.createElement("div", { className: "bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-xs text-yellow-800" }, 
                        "Sistem menggunakan API Fonnte untuk mengirim notifikasi WhatsApp. Pastikan token aktif."
                    ),
                    React.createElement("div", null,
                        React.createElement("label", { className: "block text-xs font-bold text-slate-500 mb-1" }, "TOKEN FONNTE"),
                        React.createElement("input", { 
                            type: "text", 
                            placeholder: "Masukkan Token Fonnte...", 
                            className: "w-full p-2 border rounded-lg",
                            value: waConfig.token,
                            onChange: e => setWaConfig({...waConfig, token: e.target.value})
                        })
                    ),
                    React.createElement("div", null,
                        React.createElement("label", { className: "block text-xs font-bold text-slate-500 mb-1" }, "ID GROUP WHATSAPP (Pisahkan koma jika > 1)"),
                        React.createElement("input", { 
                            type: "text", 
                            placeholder: "1203630234@g.us, 1203630999@g.us", 
                            className: "w-full p-2 border rounded-lg",
                            value: waConfig.targetGroups,
                            onChange: e => setWaConfig({...waConfig, targetGroups: e.target.value})
                        })
                    ),
                    React.createElement("button", { onClick: saveSettings, disabled: loading, className: "bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50" }, 
                        loading ? "Menyimpan..." : "Simpan Konfigurasi WA"
                    )
                ),

                activeTab === 'print' && React.createElement("div", { className: "space-y-4" },
                    React.createElement("p", { className: "text-sm text-slate-500" }, "Atur koordinat (dalam milimeter) untuk posisi cetak pada blangko kosong."),
                    React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                        Object.entries(coords).map(([key, val]) => 
                            React.createElement("div", { key: key, className: "border p-3 rounded-lg bg-slate-50" },
                                React.createElement("p", { className: "font-bold text-sm mb-2" }, val.label),
                                React.createElement("div", { className: "flex gap-2" },
                                    React.createElement("div", { className: "flex-1" },
                                        React.createElement("label", { className: "text-[10px] text-slate-400 block" }, "ATAS (Y) mm"),
                                        React.createElement("input", { 
                                            type: "number", 
                                            className: "w-full p-1 border rounded", 
                                            value: val.top,
                                            onChange: e => setCoords({ ...coords, [key]: { ...val, top: Number(e.target.value) } })
                                        })
                                    ),
                                    React.createElement("div", { className: "flex-1" },
                                        React.createElement("label", { className: "text-[10px] text-slate-400 block" }, "KIRI (X) mm"),
                                        React.createElement("input", { 
                                            type: "number", 
                                            className: "w-full p-1 border rounded", 
                                            value: val.left,
                                            onChange: e => setCoords({ ...coords, [key]: { ...val, left: Number(e.target.value) } })
                                        })
                                    )
                                )
                            )
                        )
                    ),
                    React.createElement("button", { onClick: saveSettings, disabled: loading, className: "bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50 mt-4" }, 
                        loading ? "Menyimpan..." : "Simpan Koordinat"
                    )
                )
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
